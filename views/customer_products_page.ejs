<div class="customer-products-container">
  <div class="customer-filter-form">
    <h2 id="formTitle">Filter Products</h2>
    <form id="filter" action="/customer-products" method="POST">
      <div class="form-group">
        <label for="productCategory">Category:</label>
        <select id="productCategory" name="categoryId">
          <option value="">All Categories</option>
          <% categories.forEach(function(category) { %>
          <option value="<%= category.id %>" <%= filter && filter.categoryId === category.id ? 'selected' : '' %>><%= category.categoryName %></option>
          <% }); %>
        </select>
      </div>
      <div class="form-group">
        <label for="priceRange">Price Range:</label>
        <select id="priceRange" name="priceRange">
          <option value="">All Prices</option>
          <option value="1-20" <%= filter && filter.priceRange === '1-20' ? 'selected' : '' %>>$1 - $20</option>
          <option value="21-40" <%= filter && filter.priceRange === '21-40' ? 'selected' : '' %>>$21 - $40</option>
          <option value="41-60" <%= filter && filter.priceRange === '41-60' ? 'selected' : '' %>>$41 - $60</option>
          <option value="61-80" <%= filter && filter.priceRange === '61-80' ? 'selected' : '' %>>$61 - $80</option>
          <option value="81-100" <%= filter && filter.priceRange === '81-100' ? 'selected' : '' %>>$81 - $100</option>
      </select>
      </div>
      <div class="form-group">
        <label for="rating">Average Rating:</label>
        <select id="rating" name="rating">
          <option value="">All Ratings</option>
          <option value="1" <%= filter && filter.rating === '1' ? 'selected' : '' %>>1 Star</option>
          <option value="2" <%= filter && filter.rating === '2' ? 'selected' : '' %>>2 Stars</option>
          <option value="3" <%= filter && filter.rating === '3' ? 'selected' : '' %>>3 Stars</option>
          <option value="4" <%= filter && filter.rating === '4' ? 'selected' : '' %>>4 Stars</option>
          <option value="5" <%= filter && filter.rating === '5' ? 'selected' : '' %>>5 Stars</option>
       </select>
      </div>
      <button type="submit">Filter Products</button>
    </form>
  </div>

  <div class="products-list-container">
    <!-- Search Field -->
    <input type="text" id="searchInput" placeholder="Search for products..." onkeyup="filterProducts()" />

    <!-- Products List -->
    <ul id="productList">
      <% products.forEach(function(product) { %>
      <li class="product-item" data-name="<%= product.name.toLowerCase() %>">
        <img src="<%= product.imageUrl %>" alt="<%= product.name %>" style="width: 100px" />
        <div>
          <h4><%= product.name %></h4>
          <p><%= product.description %></p>
          <p>Price: $<%= product.price.toFixed(2) %></p>
          <p>Stock: <%= product.stockQuantity %></p>
        </div>
        <div>
          <button onclick="location.href='/product-details/<%= product.id %>'">Details</button>
          <button onclick="addToCart('<%= product.id %>')">Add to Cart</button>
        </div>
      </li>
      <% }); %> <% if (products.length === 0 ) { %>
      <li>No products found.</li>
      <% } %>
    </ul>
  </div>
</div>

<script>
  function filterProducts() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const productList = document.getElementById("productList");
    const products = productList.getElementsByClassName("product-item");

    Array.from(products).forEach(function (product) {
      const name = product.getAttribute("data-name");
      if (name.includes(filter)) {
        product.style.display = "";
      } else {
        product.style.display = "none";
      }
    });
  }

  function addToCart(productId) {
        fetch('/add-to-cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId: productId })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        })
        .catch(error => {
            console.error('Error adding to cart:', error);
        });
    }
</script>
